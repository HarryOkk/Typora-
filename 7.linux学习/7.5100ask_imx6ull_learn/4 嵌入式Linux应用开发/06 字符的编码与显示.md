## 1、字符编码基础

**字符集：**

​	定义了显示字符与码元的对应规则。常用的字符集有ASCII、Unicode

**编码规则：**

​	字符集在计算机中的二进制存储方式。

**字符集与编码规则的对应关系：**

| 字符集  | 编码规则                                                     | 备注                                                         |
| ------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| ASCII   | ASCII                                                        |                                                              |
| Unicode | UTF-8、UTF-16 LE、UTF-16 BE、UTF32                           | 兼容GB2312等多种字符集                                       |
| GB2312  | GB2312                                                       |                                                              |
| ANSI    | windows默认使用的字符编码方案（包含多种字符集和对应的编码规则） | 比如.c中字符串如果有中文，默认指定字符集和编码规则为GB2313/GBK |

## 2、矢量字体的显示

​	在LCD中（包括现在主流的计算机屏幕显示字符），使用矢量字体方式显示文字可以让字体的放大缩小不失真。

**矢量字体**：

​	以关键点描述字体，主要过程为：

1、确认关键点

2、使用数学曲线秒点（贝塞尔曲线）

3、填充

**矢量字体文件：**

​	在windows中，默认存储在/c/Windows/Fonts中，字体文件保存了各种**字符集**的字体的**显示关键点**信息。

​	一个矢量字体文件中可能包含多种字符集，文件中使用“charmaps”来表征各种字符集，我们可以使用字符集中某个字符的码元来计算便宜地址，进而找到对应字符的glyph（关键点信息）

​	矢量字体文件的结构如下：

![image-20240811151953710](../../../6.图片/image-20240811151953710.png)

**矢量文字符的显示过程：**

1、给定一个字符并确定它的编码值

2、确定字体大小

3、根据编码值，从字体文件中找到charmaps对应的关键点（glyph）

4、把关键点信息转换为位图点阵

5、将点阵信息显示出来（LCD）

**freetype库的使用：**

​	<img src="../../../6.图片/image-20240811151834044.png" alt="image-20240811151834044" style="zoom:33%;" />

## 3、在源代码中直接获得某一字符的Unicode值

​	我们编辑的.c文件源代码中，字符串的实际二进制存储值受.c文件的编码方式影响。

​	而在使用矢量字符文件时，我们要获得关键点（glyph）就必须拿到字符对应的码元值（如果使用Unicode编码来索引关键点的话，最好使用Unicode字符集，因为其支持和适用性比较好，在矢量字符文件中也不需要索引对应的chamaps），**问题就来了，我们可以不可以不受.c文件的编码规则影响，而直接拿到字符的Unicode码元值？**

### 3.1 C语言的wchat_t宽字符支持

​	C语言中，定义字符串字面量为宽字符，则字符串对应的二进制值即为Unicode码元值，不受.c文件编码规则影响。

```c
#include <wchar.h>

wchar_t *chinese_str = L"中国就是最牛的。";
```

​	上面字符串字面量中：

1、每个字符都是wchar_t类型（默认占四个字节）

2、每个字符存储的二进制值均为Unicode码元值

### 3.2 gcc处理宽字符时注意

​	如果gcc编译的源文件使用GB2312编码（或者是ANSI），则应在编译时指定.c的编码规则为GN2312，以让gcc能够正常处理宽字符

```sh
gcc -finput-charset=GB2312 -o test wchar test wchar.c
```



## 4、GCC编译与字符编码

### 4.1 注意

gcc默认输入文件和输出文件均使用UTF-8编码，如果实际.c文件使用

​	